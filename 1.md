DO $$ 
DECLARE 
    ids BIGINT[]; 
    id BIGINT; 
    unique_count BIGINT; -- Добавляем переменную для хранения количества
BEGIN 
    FOR i IN 1..100 LOOP 
        PERFORM pg_sleep(0.01); 
        -- Предположим, функция возвращает BIGINT
        SELECT murex.get_next_batch_id(10) INTO id; 
        ids := array_append(ids, id); 
    END LOOP;

    -- ИСПРАВЛЕНИЕ: Вычисляем количество уникальных элементов через подзапрос
    SELECT COUNT(DISTINCT val) FROM unnest(ids) AS val INTO unique_count;

    -- Теперь сравниваем два скалярных значения
    IF array_length(ids, 1) = unique_count THEN
        RAISE NOTICE 'Все ID уникальны! (Всего: %)', unique_count;
    ELSE
        RAISE EXCEPTION 'Обнаружены дубликаты! Ожидалось %, получено уникальных %', 
            array_length(ids, 1), unique_count;
    END IF;
END $$;
