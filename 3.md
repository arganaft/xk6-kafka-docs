Ситуация классическая и крайне досадная: вы точно знаете, что пароль верный, но корпоративный прокси или Nexus/Artifactory упорно говорит «нет». В корпоративной среде проблема редко ограничивается просто опечаткой.

Давайте разберем наиболее вероятные причины, от простых к «хитрым».

---

### 1. Проблема "Не того settings.xml"

IntelliJ IDEA может игнорировать ваш глобальный файл настроек и использовать встроенный.

* **Что проверить:** Перейдите в `File` -> `Settings` -> `Build, Execution, Deployment` -> `Build Tools` -> `Maven`.
* **User settings file:** Убедитесь, что там указан путь именно к вашему файлу (обычно `~/.m2/settings.xml`), и стоит галочка **Override**.
* **Local repository:** Проверьте, что путь к репозиторию тоже корректен.

### 2. Зеркала (Mirrors) и ID серверов

Maven сопоставляет логин/пароль из секции `<servers>` с репозиторием через `<id>`.

* **Важно:** ID в секции `<server>` должен **символ в символ** совпадать с ID в секции `<mirror>` или `<repository>`.
* **Пример:**
```xml
<server>
  <id>central</id> <username>your_user</username>
  <password>your_password</password>
</server>

```



### 3. Спецсимволы в пароле

Если ваш корпоративный пароль содержит символы вроде `&`, `<`, `>`, `!`, Maven может неправильно их распарсить внутри XML.

* **Решение:** Попробуйте обернуть пароль в секцию CDATA:
`<password><![CDATA[P@ssword!123]]></password>`

### 4. Зашифрованные пароли (Maven Encryption)

В некоторых компаниях настроено шифрование паролей в `settings.xml`. Если вы просто вставили текст, а Maven ожидает расшифровки через `settings-security.xml`, будет ошибка 401.

* **Проверьте:** Нет ли у вас в папке `.m2` файла `settings-security.xml`. Если есть, пароль в `settings.xml` должен быть зашифрован (начинаться с `{...}`).

### 5. Конфликт кэша IntelliJ IDEA

Иногда IDEA «залипает» на старых учетных данных.

* **Действие:**
1. Закройте проект.
2. Удалите папку `.idea` в корне проекта.
3. В самом Maven-окне (справа) нажмите на иконку «обновить» (скрещенные стрелочки) с зажатым `Ctrl` (или просто выберите **Reload All Maven Projects**).



### 6. Проблема на уровне корпоративного Proxy

Если для выхода в интернет нужен прокси, ошибка 401 Unauthorized может прилетать не от репозитория, а от самого прокси-сервера.

* **Проверьте:** Прописана ли секция `<proxies>` в `settings.xml`.

---

### Как проверить, где именно ошибка?

Чтобы исключить влияние IntelliJ IDEA, попробуйте выполнить команду в терминале (в корне проекта):
`mvn clean install -U`

* **Если в терминале работает:** Проблема в настройках IDEA (пункты 1 и 5).
* **Если в терминале ТОЖЕ 401:** Проблема в `settings.xml` (пункты 2, 3 или 4) либо ваш аккаунт временно заблокирован из-за перебора паролей.

**Что из этого больше похоже на ваш случай?** Если терминал тоже выдает ошибку, пришлите (скрыв личные данные) структуру вашего `<server>` и `<mirror>` из `settings.xml`, я помогу проверить синтаксис.




Факт того, что через браузер файл качается, а другие зависимости из того же репозитория проходят успешно, — это «улика», которая сужает круг подозреваемых до настроек прав доступа внутри самого Nexus/Artifactory или специфики обработки запроса.

Это уже не проблема логина/пароля в вашем файле, это проблема **авторизации на конкретный путь**.

Вот что стоит проверить сейчас:

### 1. Права на конкретный "Target" (Path-based security)

В корпоративных репозиториях (особенно в Sonatype Nexus или JFrog Artifactory) права доступа часто нарезаются по маскам путей (Repository Targets).

* **Суть:** У вашей учетки могут быть права на `com/mycompany/*`, но нет прав на `org/external-library/*`, даже если они лежат в одном и том же виртуальном репозитории.
* **Что делать:** В веб-интерфейсе посмотрите, в каком конкретно **Hosted** или **Proxy** репозитории лежит этот файл. Сравните этот путь с теми зависимостями, которые скачиваются успешно. Скорее всего, проблемная библиотека находится в репозитории, на который у вашей группы пользователей нет прав "Read".

### 2. Snapshots vs Releases

Это классическая ловушка Maven.

* **Суть:** Если библиотека имеет версию `-SNAPSHOT`, Maven может пытаться искать её в репозитории, предназначенном только для релизов (или наоборот).
* **Что проверить:** * Убедитесь, что в вашем `pom.xml` или `settings.xml` для этого репозитория разрешены и релизы, и снапшоты:
```xml
<repository>
  <id>your-repo-id</id>
  <url>...</url>
  <releases><enabled>true</enabled></releases>
  <snapshots><enabled>true</enabled></snapshots>
</repository>

```


* Если библиотека — Snapshot, а репозиторий настроен только на Release, сервер может вернуть 401 или 403.



### 3. Переход с HTTP на HTTPS (Mixed Content)

Иногда корпоративный прокси или сам репозиторий настроен так, что он делает редирект.

* **Суть:** Если в `settings.xml` указан `http://...`, а сервер принудительно перекидывает на `https://...`, Maven может «терять» заголовок авторизации при редиректе в целях безопасности.
* **Что делать:** Проверьте URL в `settings.xml`. Если там `http`, замените на `https`.

### 4. Проблема с зеркалами (Mirrors)

Если у вас в `settings.xml` прописан `<mirrorOf>*</mirrorOf>`, Maven пытается абсолютно всё тянуть через один URL.

* **Что делать:** Попробуйте временно изменить зеркало на `<mirrorOf>external:*</mirrorOf>` или исключить проблемный репозиторий из-под зеркала.

---

### Временное решение (Костыль), чтобы продолжить работу

Раз вы можете скачать JAR через браузер, вы можете «обмануть» Maven и установить библиотеку в свой локальный репозиторий вручную. Тогда он перестанет ломиться за ней в сеть.

Выполните эту команду в терминале, подставив свои данные (когда скачаете jar):

```bash
mvn install:install-file \
   -Dfile=путь/к/файлу.jar \
   -DgroupId=com.example \
   -DartifactId=problem-library \
   -Dversion=1.0.0 \
   -Dpackaging=jar

```

После этого проект должен собраться, так как Maven найдет файл локально в `~/.m2/repository`.

**Какой именно репозиторий используется (Nexus или Artifactory)?** Если скажете название, я смогу подсказать, где именно в их интерфейсе посмотреть настройки прав доступа для вашего пути.

-------------------------------------------------------------------------------------------------------------------------------------------------------

Поздравляю, с зеркалами (`mirrorOf`) вы разобрались — теперь Maven видит внешние репозитории через ваш корпоративный прокси.

Однако теперь мы столкнулись с двумя новыми проблемами: **Lombok** (ошибка компиляции `log`) и **неполная синхронизация Nexus** (missing POM для OpenTelemetry).

---

### 1. Почему упала компиляция (`cannot find symbol variable log`)

Ошибка `variable log` в 99% случаев означает, что **Lombok** перестал работать. Раньше он работал, а после добавления OpenTelemetry «отвалился».

**Причина:** Когда вы добавили `dependencyManagement` для OpenTelemetry или изменили версию Java (вижу в логе **Java 21**), Maven мог изменить порядок обработки аннотаций или версию самого Lombok. В Java 21 компилятор стал строже к процессорам аннотаций.

**Как починить:**
Проверьте, что у вас в `pom.xml` в плагине `maven-compiler-plugin` явно прописан путь к процессору Lombok. Это «золотой стандарт» для Java 17/21:

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <version>3.11.0</version>
    <configuration>
        <annotationProcessorPaths>
            <path>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>1.18.30</version> </path>
            </annotationProcessorPaths>
    </configuration>
</plugin>

```

И убедитесь, что сама зависимость `lombok` есть в блоке `<dependencies>` со scope `provided`.

---

### 2. Проблема с OpenTelemetry в Nexus

В логе IDE видна критическая ошибка:
`[WARNING] The POM for io.opentelemetry.instrumentation:opentelemetry-jdbc:jar:2.20.0-alpha is missing`

**Что это значит:**
Ваш корпоративный Nexus (судя по логам, `nexus-ci.sigma.sbrf.ru`) не смог скачать файл `.pom` для одной из подзависимостей OpenTelemetry.

* Либо в вашем Nexus запрещено скачивание версий с суффиксом `-alpha`.
* Либо произошел сбой при кешировании артефакта на стороне сервера.

**Почему это случилось после добавления BOM:**
Вы подключили `opentelemetry-instrumentation-bom` версии `2.20.0`. Этот BOM внутри себя ссылается на `opentelemetry-jdbc:2.20.0-alpha`. Maven видит эту ссылку, идет в Nexus, а там этого файла нет.

**Как решить:**

1. **Попробуйте другую версию BOM:** Вместо `2.20.0` попробуйте чуть более старую или новую версию (например, `1.32.0` для стабильной ветки 1.x, если проект позволяет), где нет зависимостей с суффиксом `-alpha`.
2. **Проверьте настройки зеркала:** Вы прописали `<mirrorOf>external:*</mirrorOf>`. Это правильно, но убедитесь, что ваш `server` с логином/паролем в `settings.xml` имеет тот же `id`, что и репозиторий, с которого Maven пытается скачать этот POM (в логе это `Nexus3`).
3. **Принудительно обновите зависимости:**
Запустите в терминале:
`mvn clean install -U -DskipTests`
(Флаг `-U` заставляет Maven проверить наличие обновлений для всех зависимостей, даже если они помечены как «missing»).

---

### 3. Разница между Терминалом и IDE

В IDE вы видите дополнительные предупреждения про `JansiLoader` и `Unsafe`. Это особенности запуска Maven внутри IntelliJ IDEA на Java 21. На саму ошибку компиляции это не влияет, но подтверждает, что IDE использует свой встроенный Maven.

**Рекомендация:**

1. Вставьте блок `annotationProcessorPaths` для Lombok в `pom.xml`.
2. Замените версию OpenTelemetry BOM на стабильную (без `-alpha` компонентов), если это возможно.
3. Если файл `opentelemetry-jdbc-2.20.0-alpha.pom` так и не качается — скачайте его через браузер (раз у вас есть доступ) и положите в локальный репозиторий `.m2/repository/...` вручную.

**Попробуете добавить `annotationProcessorPaths`? Это должно сразу убрать ошибки с `log`.**
