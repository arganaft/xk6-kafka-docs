Это отличный проект для того, чтобы разобраться, как работает двусторонняя связь в реальном времени. Мы будем использовать **Spring Boot** и протокол **STOMP** (Simple Text Oriented Messaging Protocol) поверх WebSockets.

Ниже приведена пошаговая инструкция.

### 1. Структура проекта

Создай стандартный Maven-проект в IntelliJ IDEA. Твоя структура должна выглядеть примерно так:

```text
src/main/java/com/example/chat
  ├── ChatApplication.java
  ├── config/WebSocketConfig.java
  ├── controller/ChatController.java
  ├── model/ChatMessage.java
src/main/resources
  ├── static/index.html
  └── static/js/main.js (опционально, можно всё в HTML)

```

---

### 2. Зависимости (pom.xml)

Тебе понадобится основной стартер для веб-приложений и стартер для работы с WebSocket.

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-websocket</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
</dependencies>

```

---

### 3. Конфигурация WebSocket

Этот класс настраивает "брокер сообщений", который будет рассылать сообщения всем подключенным пользователям.

```java
package com.example.chat.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.*;

@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        // Точка входа для подключения клиента
        registry.addEndpoint("/ws").withSockJS();
    }

    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        // Префикс для сообщений, которые идут от сервера к клиенту
        registry.enableSimpleBroker("/topic");
        // Префикс для сообщений, которые клиент отправляет на сервер
        registry.setApplicationDestinationPrefixes("/app");
    }
}

```

---

### 4. Модель сообщения и Контроллер

Создадим простой объект сообщения и контроллер, который будет принимать сообщение и пересылать его в общую "тему" (`/topic/public`).

**ChatMessage.java**

```java
public class ChatMessage {
    private String content;
    private String sender;
    // Геттеры и сеттеры обязательны
    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
    public String getSender() { return sender; }
    public void setSender(String sender) { this.sender = sender; }
}

```

**ChatController.java**

```java
@Controller
public class ChatController {
    @MessageMapping("/chat.sendMessage")
    @SendTo("/topic/public")
    public ChatMessage sendMessage(@Payload ChatMessage chatMessage) {
        return chatMessage;
    }
}

```

---

### 5. Фронтенд (index.html)

Создай файл `src/main/resources/static/index.html`. Чтобы не усложнять, я добавлю JS прямо внутрь. Мы будем использовать библиотеки **SockJS** и **STOMP.js**.

```html
<!DOCTYPE html>
<html>
<head>
    <title>Spring Boot Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
    <div id="chat-page">
        <input type="text" id="name" placeholder="Твоё имя" />
        <button onclick="connect()">Войти в чат</button>
        <hr>
        <div id="messageArea" style="height: 300px; overflow-y: scroll; border: 1px solid #ccc;"></div>
        <input type="text" id="message" placeholder="Напиши что-нибудь..." />
        <button onclick="sendMessage()">Отправить</button>
    </div>

    <script>
        var stompClient = null;
        var username = null;

        function connect() {
            username = document.querySelector('#name').value;
            if(username) {
                var socket = new SockJS('/ws');
                stompClient = Stomp.over(socket);
                stompClient.connect({}, function() {
                    stompClient.subscribe('/topic/public', function(payload) {
                        var message = JSON.parse(payload.body);
                        var messageElement = document.createElement('p');
                        messageElement.innerText = message.sender + ": " + message.content;
                        document.querySelector('#messageArea').appendChild(messageElement);
                    });
                });
            }
        }

        function sendMessage() {
            var messageContent = document.querySelector('#message').value;
            if(messageContent && stompClient) {
                var chatMessage = { sender: username, content: messageContent };
                stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));
                document.querySelector('#message').value = '';
            }
        }
    </script>
</body>
</html>

```

---

### Как запустить:

1. **Создай главный класс** `ChatApplication` с аннотацией `@SpringBootApplication` и методом `main`.
2. **Запусти** проект в IntelliJ IDEA.
3. **Открой браузер**: перейди по адресу `http://localhost:8080`.
4. **Проверь магию**: открой этот же адрес в двух разных вкладках (или разных браузерах). Напиши сообщение в одной — оно мгновенно появится в другой!

**Маленький совет:** если в браузере ничего не происходит, нажми `F12` и загляни в Console. Чаще всего ошибки связаны с тем, что библиотеки SockJS не успели прогрузиться.

Хочешь, чтобы я помог добавить в этот чат уведомления о том, что "Пользователь X вошел в чат"?
